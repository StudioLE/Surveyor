<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <SurveyorPackage Condition="'$(SurveyorPackage)' == ''">$(AssemblyName)</SurveyorPackage>
    <SurveyorDirectory Condition="'$(SurveyorDirectory)' == ''">$(MSBuildProjectDirectory)</SurveyorDirectory>
  </PropertyGroup>

  <Target Name="BuildVersioning" BeforeTargets="BeforeBuild;GenerateNuspec" Condition="Exists('$(SurveyorAssemblyPath)') AND '$(Configuration)' == 'Release'">
    <VersioningTask
      Package="$(SurveyorPackage)"
      Directory="$(SurveyorDirectory)"
      Branch="$(SurveyorBranch)"
      Feed="$(SurveyorFeed)"
      Token="$(SurveyorToken)">
      <Output TaskParameter="VersionPrefix" PropertyName="VersionPrefix"/>
      <Output TaskParameter="VersionSuffix" PropertyName="VersionSuffix"/>
      <Output TaskParameter="Version" PropertyName="PackageVersion"/>
    </VersioningTask>
    <Message Text="VersionPrefix: $(VersionPrefix)" Importance="high"/>
    <Message Text="VersionSuffix: $(VersionSuffix)" Importance="high"/>
    <Message Text="PackageVersion: $(PackageVersion)" Importance="high"/>
  </Target>

  <Target Name="NoVersioning" BeforeTargets="BeforeBuild;GenerateNuspec" Condition=" ! Exists('$(SurveyorAssemblyPath)')">
    <Warning Text="Surveyor assembly not found: $(SurveyorAssemblyPath)"/>
    <Warning Text="Versioning has failed but build will continue."/>
  </Target>

</Project>
